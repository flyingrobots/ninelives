---
id: P8.03
title: gRPC Transport
estimate: 10h
status: blocked
blocked_by:
- P8.01
blocks:
- P7.02
value: M
---
# [P8.03] gRPC Transport

## Summary

Implement a `ninelives-grpc` crate that provides a gRPC interface for the `ninelives-control` plane. This offers a high-performance, strongly-typed alternative to HTTP REST for clients that prefer gRPC.

## Context

gRPC provides benefits like HTTP/2 multiplexing, protocol buffers for efficient serialization, and strong type safety. This is ideal for inter-service communication within a microservices architecture. It will leverage P8.01 for wire format definition (using Protocol Buffers instead of JSON) and P2.14 for transport abstraction.

## Design
- **Crate**: `ninelives-grpc`.
- **Protocol Buffers**: Define `.proto` files for commands, responses, and `AuthPayload`s.
- **Server Framework**: Use `tonic` for building the gRPC server.
- **Authentication**: Leverage gRPC interceptors or `tonic`'s built-in TLS/mTLS support for authentication, integrating with `ninelives-control`'s `AuthRegistry`.
- **Error Mapping**: Map `CommandError` variants to appropriate gRPC status codes.

## Definition of Done
- [ ] `ninelives-grpc` crate created.
- [ ] `.proto` files defined for control plane commands.
- [ ] gRPC server capable of receiving and dispatching commands.
- [ ] Authentication (e.g., mTLS) integrated.
- [ ] Correct gRPC status codes returned for various `CommandError`s.
- [ ] Example gRPC client demonstrates usage.

## Test Plan

### Unit Tests
- [ ] **Proto Conversion**: Test `CommandEnvelope` <-> Protobuf message conversion.
- [ ] **Error Mapping**: Test `CommandError` to gRPC status code mapping.

### Integration Tests
- [ ] **End-to-End Command**: Start the gRPC server, send a command via a gRPC client, and verify execution.
- [ ] **Authentication**: Test with authenticated and unauthenticated gRPC requests.

## Dependencies
- **Requires**: P8.01 (Command Serialization - will adapt to protobuf), P2.14 (Transport Abstraction), P7.02 (ninelives-control crate).
- **Enables**: High-performance control plane integration for GATOS.