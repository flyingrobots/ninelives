---
id: P8.02
title: HTTP REST Transport
estimate: 10h
status: blocked
blocked_by:
- P8.01
blocks:
- P7.02
value: H
---
# [P8.02] HTTP REST Transport

## Summary

Implement a `ninelives-rest` crate that provides an HTTP REST interface for the `ninelives-control` plane. This will expose the `CommandRouter` via standard HTTP endpoints, enabling easy integration with CLI tools, web UIs, and other HTTP-based clients.

## Context

HTTP REST is a ubiquitous protocol, making it a natural choice for exposing the control plane. This transport will leverage the serialization/deserialization logic from P8.01 and the `Transport` trait from P2.14.

## Design
- **Crate**: `ninelives-rest`.
- **Server Framework**: Use a lightweight, high-performance async web framework (e.g., `axum` or `warp`).
- **Endpoints**:
    - `POST /commands`: For executing all `BuiltInCommand`s.
    - `GET /configs/{path}`: For `ReadConfig`.
    - `PUT /configs/{path}`: For `WriteConfig`.
- **Authentication Middleware**: Integrate with `ninelives-control`'s `AuthRegistry` to enforce authentication via HTTP headers (e.g., `Authorization: Bearer <JWT>`).
- **Error Mapping**: Map `CommandError` variants to appropriate HTTP status codes (e.g., `401 Unauthorized`, `400 Bad Request`, `404 Not Found`, `500 Internal Server Error`).

## Definition of Done
- [ ] `ninelives-rest` crate created.
- [ ] HTTP server capable of receiving and dispatching commands via the `CommandRouter`.
- [ ] Authentication middleware integrated.
- [ ] Correct HTTP status codes returned for various `CommandError`s.
- [ ] Basic CLI or `curl` examples demonstrating usage.

## Test Plan

### Unit Tests
- [ ] **Middleware**: Test HTTP authentication middleware with mock `AuthRegistry`.
- [ ] **Error Mapping**: Test that each `CommandError` variant maps to the correct HTTP status code.

### Integration Tests
- [ ] **End-to-End Command**: Start the HTTP server, send a `WriteConfig` command via `curl`, and verify the configuration is updated.
- [ ] **Unauthorized Access**: Send a request without authentication; verify `401 Unauthorized`.
- [ ] **Bad Request**: Send a malformed JSON payload; verify `400 Bad Request`.

## Cookbook Idea
"Remote Control": Use `ninelives-rest` to expose a local `ninelives` instance to a remote `gatos-cli` via HTTP.

## Dependencies
- **Requires**: P8.01 (Command Serialization), P2.14 (Transport Abstraction), P7.02 (ninelives-control crate).
- **Enables**: GATOS CLI integration (M8).