---
id: P2.11
title: System State Query (Debug)
estimate: 2h
status: closed
blocked_by:
- P2.09
- P2.121
blocks:
- P2.19
value: L
---
# [P2.11] System State Query (Debug)

## Summary

Implement a simple `GetState` command that returns a snapshot of critical system state (primarily Circuit Breaker statuses) for debugging purposes.

## Context

While a full "Observer" (Phase 5) will provide queryable, historical metrics, we need a lightweight way *now* to ask "Why is my service failing?" and see "Ah, the circuit breaker is Open".

## Steps
1. **Registry Inspection**: Ensure `CircuitBreakerRegistry` exposes state snapshotting (iterating over all breakers and getting their state/counts).
2. **Command**: Add `BuiltInCommand::GetState`.
3. **Response Schema**: Define a JSON structure for the state (e.g., `{"breakers": {"kms": "Closed", "s3": "Open"}}`).
4. **Handler**: Implement the logic to gather data and serialize it.

## Ready When
- [ ] `GetState` command returns valid JSON with breaker statuses.
- [ ] Registry supports iteration/snapshotting.

## Test Plan

### Unit Tests
- [ ] **Snapshot**: Registry returns correct states for multiple breakers.

### Integration Tests
- [ ] **Trip and Query**:
    1. Trip a breaker.
    2. Call `GetState`.
    3. Verify JSON shows that specific breaker is "Open".