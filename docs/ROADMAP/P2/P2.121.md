---
id: P2.121
title: Circuit breaker registry + ids
estimate: 1h
status: closed
blocked_by: []
blocks:
- P2.12
- P2.11
value: H
---
# [P2.121] Circuit breaker registry + ids

## Summary

Implement a global `CircuitBreakerRegistry` to manage named circuit breaker instances. This allows control plane commands (like Reset) to target specific breakers by ID.

## Implementation

- **Registry**: A `ArcSwap<HashMap<String, Arc<CircuitBreaker>>>` or similar structure (actually implemented using `dashmap` or `RwLock`).
- **Registration**: `CircuitBreakerLayer::new` now takes an ID and registers itself.
- **Global Access**: A `global()` function provides access to the registry singleton.

## Definition of Done
- [x] `CircuitBreakerRegistry` struct implemented.
- [x] `global()` accessor available.
- [x] Breakers register themselves on creation.
- [x] Lookup by ID supported.

## Test Plan
- [x] Unit tests verify registration and retrieval.