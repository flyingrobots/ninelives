---
id: P2.16b
title: Authorization Logic Integration
estimate: 1.5h
status: closed
blocked_by:
- P2.16a
blocks:
- P2.18
value: H
---
# [P2.16b] Authorization Logic Integration

## Summary

Implement the actual `call()` logic for `AuthorizationService`. It should inspect the request context, verify permissions, and either error out or forward to the inner service.

## Steps
1.  In `call()`, extract `CommandContext` (or relevant auth info).
2.  Call `provider.authorize()`.
3.  If allowed, call `inner.call()`.
4.  If denied, return `Box::pin(async { Err(CommandError::Auth(...)) })`.

## Definition of Done
- [x] `AuthorizationService::call()` invokes `AuthRegistry::authenticate` (authZ included) and short-circuits on failure.
- [x] Denials stop the request and surface `CommandError::Auth`.

## Test Plan
- [x] Unit test with mock provider: verify "allow" forwards and "deny" blocks (`auth_mode_first_stops_on_success`).
