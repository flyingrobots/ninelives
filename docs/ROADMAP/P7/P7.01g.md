---
id: P7.01g
title: Refactor to Unboxed Futures
estimate: 4h
status: blocked
blocked_by:
- P7.01c
blocks:
- P7.01d
value: H
---
# [P7.01g] Refactor to Unboxed Futures

## Summary

Replace `BoxFuture` with `pin-project` based future structs in core services (`RetryService`, `CircuitBreakerService`, `FallbackService`, `ForkJoinService`).

## Context

Currently, every request allocates a `BoxFuture`. In high-throughput scenarios, this allocator pressure is significant. Converting to named future structs (zero-allocation state machines) is a standard optimization in the Tower ecosystem.

## Steps
1.  Add `pin-project` dependency.
2.  For each core service:
    - Define `pub struct ResponseFuture<...>`.
    - Implement `Future` for it.
    - Change `Service::call` to return `ResponseFuture`.

## Definition of Done
- [ ] Core services return unboxed futures.
- [ ] `cargo check` confirms types match.

## Test Plan
- [ ] Existing tests pass (refactor should be transparent).
