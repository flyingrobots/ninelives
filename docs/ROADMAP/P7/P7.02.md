---
id: P7.02
title: Control & Observer Crates Split
estimate: 8h
status: blocked
blocked_by:
- P7.01
- P8.01
- P8.02
- P8.03
- P10.04
blocks:
- P7.03
- P2.19
- P3.02b
value: M
---
# [P7.02] Control & Observer Crates Split

## Summary

Extract the Control Plane components (from P2) into a `ninelives-control` crate and the Telemetry Aggregator/Observer components (from P3) into a `ninelives-observer` crate.

## Context

Following the core split (P7.01), these two major functional blocks have distinct responsibilities and dependencies. Separating them further improves modularity, allows users to pick and choose only the parts they need, and clarifies the architecture.

## Design
- **`ninelives-control`**:
    - Contains `CommandEnvelope`, `AuthRegistry`, `CommandRouter`, `BuiltInCommand`, `ConfigRegistry`, `TelemetrySink` traits/impls specifically for auditing commands.
    - Depends on `ninelives-core`.
- **`ninelives-observer`**:
    - Contains `TelemetryAggregator`, `WindowedMetrics`, `FeedbackLoop`, `ControlLaw` traits, and specific adaptive laws (AIMD, Retry Budget).
    - Depends on `ninelives-core`.

## Definition of Done
- [ ] `ninelives-control` crate created and contains all control plane logic.
- [ ] `ninelives-observer` crate created and contains all observer/adaptive logic.
- [ ] `ninelives` meta-crate re-exports relevant parts from `ninelives-control` and `ninelives-observer`.
- [ ] All existing tests and examples compile and pass against the new structure.

## Test Plan

### Unit Tests
- [ ] All control plane unit tests moved to `ninelives-control` and pass.
- [ ] All observer/adaptive unit tests moved to `ninelives-observer` and pass.

### Integration Tests
- [ ] Existing integration tests that combine control and observer logic (e.g., `ninelives-sentinel` examples) compile and pass against the new crates.

### Build/CI
- [ ] CI pipeline for the workspace passes with these new crates.

## Dependencies
- **Requires**: P7.01 (Core Crate Split), P2.19 (Control Plane to be complete), P3.02 (Telemetry Aggregator to be complete).
- **Enables**: P7.03 (Compatibility & Adapters), P8 (Transport Protocols leveraging `ninelives-control`).