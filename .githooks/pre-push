#!/usr/bin/env bash
set -euo pipefail

echo "[pre-push] running cargo fmt -- --check"
cargo fmt -- --check

echo "[pre-push] running cargo clippy --all-targets --all-features -- -D warnings -D missing_docs"
cargo clippy --all-targets --all-features -- -D warnings -D missing_docs

echo "[pre-push] running cargo test --all-features --all-targets"
cargo test --all-features --all-targets

echo "[pre-push] running cargo doc --no-deps with -D warnings"
RUSTDOCFLAGS="-D warnings" cargo doc --no-deps

if ! command -v cargo-llvm-cov >/dev/null 2>&1; then
  echo "[pre-push] installing cargo-llvm-cov (missing locally)"
  cargo install cargo-llvm-cov --locked
fi

echo "[pre-push] running cargo llvm-cov --package ninelives --all-features (no report)"
cargo llvm-cov --package ninelives --all-features --no-report

echo "[pre-push] all checks passed"
