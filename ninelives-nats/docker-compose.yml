version: '3.8'
services:
  nats:
    image: nats:2.10-alpine
    command: -js
    ports:
      - "127.0.0.1:4222:4222"  # if local-only
      # or
      # - "192.168.x.y:4222:4222"  # if specific interface required
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "4222"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 5s
    volumes:
      - nats-jetstream:/data

volumes:
  nats-jetstream:
